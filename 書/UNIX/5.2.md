## 5.2 文件許可權管理

在UNIX系統中，每個文件都有一個許可權屬性，用來控制該文件對使用者的可見性和可操作性。UNIX系統中一共有三種許可權，分別為讀取權限、寫入權限和執行權限。

### 5.2.1 許可權格式

UNIX系統中，每個文件的權限信息都保存在一個16進制數字中，稱為許可權位。一般來說，8個二進制位分別代表讀、寫、執行權限，每3位二進制位對應一個八進制數字，稱為屬主、屬組和其他三種文件使用者的許可權。

例如，一個檔案許可權為`rwxr-xr--`，表示許可權位為`rwx`、`r-x`、`r--`，其中前三個字符表示屬主的許可權，中間三個字符表示屬組的許可權，後三個字符表示其他用戶的許可權。

`r`表示讀取，`w`表示寫入，`x`表示執行，`-`表示沒有對應的許可權。因此，`rwxr-xr--`表示該文件屬主可以讀寫執行，屬組可以讀寫，其他使用者只能讀取。

### 5.2.2 設置許可權

UNIX系統下，可以使用 `chmod` 命令來更改文件的許可權，其語法如下：

```
chmod [選項] 權限模式 檔案名稱
```

其中 `權限模式` 可以使用以下三種方式指定：

- 數字方式：使用八進制數字表示各種許可權的授予情況。例如，`777` 表示设置文件属主、属组和其他用户的 `rwx` 权限。
- 符號方式：使用符号 `+`、 `-`、 `=` 和各种权限简称来设置文件的相应权限。例如，使用 `+r` 命令为文件添加读权限。
- 混合方式：即同时使用数字方式和符号方式。

下面分别介绍一下三种方式的使用。

#### 1. 數字方式

在使用数字方式设置文件访问权限时，需要记住以下几点：

- 每个访问者的权限都对应一个数值，分别是4、2、1，其表示的含义如下：

  ```
  r（读） w（写） x（执行）
  --------------
  4             2              1
  ```

- 将所有访问者的数值相加即可得出该文件的访问权限数值。

例如，读写执行的访问权限的值为 `4+2+1=7`。

設置文件許可權的方式如下：

```
chmod 755 file.txt
```

其中 `7` 是第一個數字，表示設置檔案屬主的許可權為 `rwx`，`5` 是第二和第三個數字，表示設置檔案屬組和其他用戶的許可權為 `r-x`。

如果想要更改目錄的許可權，需要使用 `-R` 選項以遞歸的方式更改目錄內的所有文件和子目錄的許可權。

```
chmod -R 755 dir/
```

#### 2. 符號方式

在使用符号方式修改文件的访问权限时，需要记住以下几点：

- 每个文件的权限都是由属主、属组和其他访问者三个作用域的权限和一些特殊权限所组合成的。
- 符号加号和减号表示添加或删除某项权限。
- 符号等号代表仅按照所要求的模式设置权限，而不管原有的权限如何。

常用的符号和权限缩写如下：

```
符号    含义
-------------------
+       增加权限
-       删除权限
=       指定权限

权限缩写 
-------------------
r       读权限
w       写权限
x       执行权限
```

例如，使用符號方式將 `file.txt` 的屬主權限添加讀取權限，寫成以下指令：

```
chmod u+r file.txt
```

其中 `u` 代表屬主，`+` 代表添加功能，`r` 代表讀取權限。

如果要為屬主和屬組設置相同的許可權，可以寫成以下指令：

```
chmod g=u file.txt
```

其中 `g` 代表屬組，`=` 代表設置相同的許可權，`u` 代表屬主。

#### 3. 混合方式

混合方式即同时使用数字方式和符号方式，例如 `chmod 754 file.txt`，其中 `7` 表示设置文件属主的 `rwx` 权限，`5` 表示设置文件属组的 `r-x` 权限，`4` 表示设置文件其他用户的 `r--` 权限。

### 5.2.3 注意事項

文件許可權管理在Unix系統中非常重要，許多系統服務和應用程序都依賴於文件的許可權，因此需要注意以下幾點：

1. 確保文件許可權的正確性

每個文件的許可權都是授予給特定用戶或用戶組的，如果許可權被不當更改，就可能會導致應用程序或服務無法運行。為了確保許可權的正確性，需要對不同的文件定期進行檢查，以確定其是否符合設置要求。

2. 設置最低許可權

為了保護系統的安全性，應該限制許可權的使用範圍，並設置最低的許可權。一般來說，文件的許可權設置為 `r-xr-xr-x`，目錄的許可權設置為 `rwxr-xr-x`。

3. 不要為所有人授予權限

為了保護敏感文件的安全性，不要為所有人授予權限，只需要授予必要的用戶即可。

4. 適時更改許可權

如果發現許可權不當，應及時進行更改，以防止導致應用程序無法運行或敏感文件遭到非授權訪問。