# 第三章：語法制備

## 語法制備的概念和作用

語法制備（Grammar Preparation）是指在進行編譯器設計時，需要將原始程序轉換為一種可以被編譯器認識和處理的形式，即語法制備。語法制備的目的是將原始程序轉換為一個抽象的語法結構，以便進行後續的語法分析、語意分析等處理。

語法制備的過程包括以下幾個步驟：

1. 字符串解析。將原始程序按照字符的類型進行解析，將其轉換為一個個符號，包括關鍵字、操作符、標識符、常量等。

2. 構建語法結構。根據程序的語法規則，將符號序列轉換為一個抽象的語法結構，例如抽象語法樹（AST）或者語法分析表格。

3. 語法檢查。對構建出的語法結構進行語法檢查，檢查其是否符合程序語法規則，並且進行錯誤處理。

4. 轉換為中間表示形式。將構建出的語法結構轉換為一種中間表示形式，以便進行後續的語意分析、優化等處理。

語法制備的作用是將原始程序轉換為編譯器所需的中間表示形式，為後續的語法分析、語意分析、優化等處理打下基礎。語法制備過程中需要關注語法歧義、語法糾錯等問題，以確保程序可以被正確地轉換為中間表示形式。

## 正規文法和上下文無關文法的區別

在編譯器設計中，文法（Grammar）是描述程序語言語法結構的形式化規則。文法分為不同類型，其中包括正規文法（Regular Grammar）和上下文無關文法（Context-Free Grammar）。

正規文法是一種用來描述正規語言的文法，其中正規語言是指可以被正規表達式或有限狀態自動機所識別的語言。正規文法的產生式只能有以下三種形式：

1. A -> aB
2. A -> a
3. A -> ε

其中，A和B是非終端符號，a是終端符號，ε表示空字串。

上下文無關文法是一種用來描述上下文無關語言的文法，其中上下文無關語言是指可以被上下文無關語言所識別的語言。上下文無關文法的產生式只能有以下形式：

1. A -> α
2. A -> βBγ

其中，A、B是非終端符號，α、β、γ是符號串。這裡的產生式的左側只有一個非終端符號，右側的符號串可以是終端符號和非終端符號的任意組合。

總的來說，正規文法和上下文無關文法的主要區別在於它們所能描述的語言類型不同。正規文法只能描述正規語言，而上下文無關文法可以描述更加複雜的語言，包括正規語言在內。在編譯器設計中，常用的文法類型為上下文無關文法，因為它可以描述程序語言中複雜的語法結構，例如遞歸、循環等。

## 語法制備的算法和實現

語法制備是編譯器設計中的一個重要步驟，其目的是將程序語言的語法結構轉換為一個形式化的文法表示。以下是語法制備的算法和實現方式：

### 自頂向下的語法制備算法

自頂向下的語法制備算法通常是基於上下文無關文法進行的。其過程是通過一系列的規則，從最上層的非終端符號開始構建語法樹，最終得到一個可以被編譯器解析的符號串。

以下是自頂向下的語法制備算法的具體步驟：

1. 確定起始符號，一般情況下為程序語言中的某個非終端符號。
2. 確定每個非終端符號的產生式，以及對應的動作（如生成代碼、語法樹等）。
3. 以起始符號為根節點，按照產生式和動作逐步構建語法樹。
4. 對於每一個終端符號，編寫相應的語法分析程序。
5. 對於每一個非終端符號，設計對應的遞歸下降分析程序。

自頂向下的語法制備算法通常是比較直觀和易於理解的。但是，它的缺點是對於某些具有左遞歸或遞歸下降的文法，可能會導致無限遞歸，使得程序無法正常運行。

### 自底向上的語法制備算法

自底向上的語法制備算法是基於移進-歸納（shift-reduce）運算進行的。在這種算法中，編譯器會從終端符號開始，逐步將符號推入堆棧中，並進行歸納分析，直到堆棧頂部的符號對應到一個非終端符號的產生式。通過這種方式，編譯器可以構建出一個語法樹。

以下是自底向上的語法制備算法的具體步驟：

1. 確定起始符號，一般情況下為程序語言中的某個非終端符
2. 確定每個非終端符號的產生式，以及對應的動作（如生成代碼、語法樹等）。
3. 將符號串轉換為一個標記串，每個標記都對應到符號串中的一個終端符號或特殊符號（如結束符號）。
4. 建立一個狀態堆棧和一個符號堆棧。初始時，狀態堆棧只包含一個狀態（通常是狀態0），符號堆棧為空。
5. 從標記串的開始位置開始，逐步向右移動。對於每個標記，執行以下操作：
    * 如果存在一個移進動作，則將該標記推入符號堆棧中，並進入相應的狀態。
    * 如果存在一個歸納動作，則從符號堆棧中彈出一定數量的符號（通常是產生式右部符號的數量），然後將產生式左部符號推入符號堆棧中。同時執行相應的動作。
    * 如果存在一個錯誤動作，則報告語法錯誤。
6. 如果最終符號堆棧中只包含一個符號（起始符號），且已經讀取完整個標記串，則語法分析成功，否則報告語法錯誤。

自底向上的語法制備算法通常比自頂向下算法更強大，可以處理更加複雜的文法。但是，由於其算法比較複雜，因此相對難以理解和實現。
